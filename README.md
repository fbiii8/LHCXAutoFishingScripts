# Alice's LHCX Auto Fishing Scripts

灵魂潮汐自动钓鱼脚本, 制作不易, 各位大佬下载前请先点个Star

出于需要实时监测的目的，请仔细阅读使用方法！！！

**本脚本仅供学习交流使用! 不会在任何途径任何场合收取费用! 请勿用于非法用途! **

**本脚本遵守GPL-3.0协议, 请勿从其他任何非官方(Github)途径下载该脚本! ( ｀д′)**

需要注意:

+ 电脑需要安装python运行环境.
+ 需要配合安卓模拟器(推荐)使用.
+ 这里仅讨论windows平台的使用.
+ 默认读者已经有一定的动手能力.

功能特点:

+ [ √ ] 连续钓鱼
+ [ √ ] 自动选鱼饵（需要在代码中指定，详见main.py）
+ [ √ ] 快速处理紫鱼，金鱼（请使用迟缓鱼竿或幸运鱼竿，别的鱼竿也能钓但不保证能上）
+ [ √ ] 稳定处理彩鱼
+ [ × ] 自动定位模拟器在主屏幕中位置
+ [ × ] 自动处理后宅
+ [ × ] 代码整理和封装

**脚本还在完善中, 配置和运行方式都可能会(向着更简便更合理的方向)改变！！！
因此使用者每次更新代码请关注该文档的更新，运行时遇到错误先查阅文档说明，也可在issues中请求帮助。**

## 使用方法

原理是通过ADB对手机屏幕截图, 对比模板图片判断当前游戏情况, 然后通过ADB模拟点击/拖拽等操作.

但对于**实时钓鱼**操作，ADB处理延迟至少为0.7s, 这样的延迟会无限空军；因此作者这里引入Pyautogui通过电脑外部点击来实现实时监控

### 环境搭建

#### 安装python

前往 [miniconda](https://docs.conda.io/en/latest/miniconda.html) 下载 python 3.7 安装包并安装.

安装时注意配置运行环境(path).

    如何判断python安装成功?
    
    打开cmd, 执行 `python --version`, 如果正确显示python版本号则说明安装成功

#### 安装python依赖

需要用户手动安装cv2,pyautogui 等.

    pip install opencv-python
    pip install pyautogui

#### 关于ADB和设备

本项目已经自带了adb.exe程序. 用户不必再手动下载.

许多安卓模拟器也会自带adb程序, 不过其自带的版本往往比较低, 一些功能残缺. 因此程序默认使用自带的adb程序。

+ 需要用户查找当前模拟器的ADB连接端口。然后修改配置文件 `config.ini` 中 `adb_host_port` 配置
+ 支持多设备在线时指定某设备连接地址进行操作。但务必配置 `adb_host_port`

##### 模拟器使用分享

不同的模拟器在ADB的实现细节上不同，游戏的体验上也不同。下表是近期（2020-03）的一些体验。欢迎体验的小伙伴贡献经验。

| 模拟器 | ADB端口 | 游戏体验 | 备注（CPU等资源占用情况）    |
| ------ | ------- | -------- | ---------------------------- |
| 雷电   | 5555    | 3.5      | 占用未注意，掉帧相对严重     |
| 逍遥   | 21503   | 4.5      | 占用相对较低，偶尔会卡死     |
| MUMU   | 7555    | 4        | 占用和逍遥接近，声称不会卡死 |
| 夜神   | 62001   |          |                              |
| 蓝叠   | 5555    |          |                              |
| 天天   | 5037    |          |                              |

> 注：游戏体验是指运行是否流畅，掉帧是否严重等情况。1~5分，分数越高体验相对越好。打分全凭个人感受。

> 注：模拟器卡顿掉帧并不一定是模拟器的问题，这游戏优化本来就不太好。在我安卓手机上（小米Note3）运行也跟雷电模拟器一样，60帧开起来跟没开一样。


## 配置文件

第一次下载本项目时，项目根目录有一个 `config_temp.ini` 配置文件。

这个文件介绍了该项目可进行的配置项，但项目的运行**不会**使用此配置文件！

用户需要将该配置文件拷贝一份并重命名为 `config.ini`，然后自行修改配置。**只有 `config.ini` 文件的配置才会生效。**

请仔细阅读配置项说明。

**（如果您不想深度参与代码构建，则必须设置模拟器分辨率为1280*720，且模拟器初始位置处于默认位置，切勿移动）请自行测量模拟器启动后钓鱼框左上角的位置，确保截取的位置包括鱼的中线在内（如果您不明白，什么是中线，下面有一个截取样例）**

**样例**：

图像很细，仅仅是一个600+ * 3 的图像

![haha-green](https://raw.githubusercontent.com/sixone-Jiang/Picgo/main/img/haha-green.jpg)

**您应当将所测量的参数用于 /bin/StartFish.py类的初始化参数中:**

需要填入的参数包括：

* 自行测量屏幕中钓鱼显示框左边界和上边界位置

  mumu_left = 950（需要自行寻找）

  mumu_top = 605（需要自行寻找）

*  自行找一个屏幕中方便点击的初始点（要位于模拟器内）

  click_x_origin = 1000（需要自行寻找）

  click_y_origin = 1000（需要自行寻找）

此外，**如果您有个性化需求，请仔细阅读main.py中的代码注释**

## 运行代码

* 请务必使用带有**管理员权限**的命令行运行代码，在主目录下(工作目录请不要带**中文路径**)，运行

  ```shell
  conda activate you-env
  python main.py
  ```

* 效果展示：

  见[bilibili](https://www.bilibili.com/video/BV1Qg41167C2/?vd_source=fd58b54cc00f8fdcc9c5eb4422b3eefd),如果失效请搜索个人主页：**ET丨Alice**

* 钓鱼妙法：

  见[Bwiki](https://wiki.biligame.com/lhcx/%E5%AE%B6%E5%9B%AD%E9%92%93%E9%B1%BC%E6%95%B0%E6%8D%AE%E4%B8%80%E8%A7%88)

* 附上我的钓鱼图鉴

  ![image-20220821131023412](https://raw.githubusercontent.com/sixone-Jiang/Picgo/main/img/image-20220821131023412.png)

## 代码逻辑

* 时间关系，如果您对代码逻辑感兴趣或有更好的看法，整理好您的意见，请发送到这里:[邮箱](skblu_alice@foxmail.com)

## 已知问题

* 当前使用win32ui API （用于屏幕截图）在代码运行10分钟左右概率抛出异常，该异常不属于BUG，使用try捕获后直接抛出执行下一轮可解决，现代码提供了另一种实时方案